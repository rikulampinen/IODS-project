# Chapter 2: Data wrangling and performing a regression analysis

#### *Work of week 45 (4.11. - 10.11.2019)*

***
## 1. Data wrangling

**4.11.2019**: Started to work through the DataCamp exercises offered by the IODS course and was able to finish  

* R Short and Sweet   
* R Helsinki Open Data Science courses      
    

**5.11.2019**: Start to work on R script for data wrangling and regression analysis  

* Wrote the script for data wrangling and was able to finish that part (all tests on the script worked)
  
### 1.1. Read the dataframe  

##### **Script of the data read (reading the dataframe from the website)**
  
```{r, readdata1, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
# Read the data file ----
learning2014 <- read.table(file = 
                "https://www.mv.helsinki.fi/home/kvehkala/JYTmooc/JYTOPKYS3-data.txt", 
                sep = "\t", header = TRUE)                          
                # read the data file and assign it to the object "learning2014"

# Explore the read data ----

View(learning2014) # see the whole dataset in a new window
str(learning2014) # check the structure of the dataset --> --> (observations = rows and variables = columns)
dim(learning2014) # check the table dimensions --> (observations = rows and variables = columns)
```
  
The dataset consists of 183 observations (rows) in 60 variables (columns). 
  
If you want to check the data also with some diagrams, you can use for example following plots:  

```
# Structure of some the data in plot or in a histogram (here the variable Points from)
library(ggplot2)
qplot(Attitude, Points, data = learning2014)
hist(learning2014$Points)
```
  
  
What follows now is the data wrangling. We have to summarize variables of deep, surface and strategic learning approaches and calclulate the mean value of the summarized variables. Other variables stay (gender, Attitude, Points), only the column names are changed.
  
### 1.2. Perform the data wrangling  

##### **Script for data wrangling**

I decided to do the data wrangling into a new R object (a dataframe) which I named "lrn14_analysis". This dataframe will later be used for the data analyses.  
Here I used a more complicated way to do the data wrangling, in the meeting on Wednesday, 6.11. a way with the pipe operator %>% was presented.  
  
```{r, wrangledata, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
# Create an analysis dataset: "lrn14_analysis" ----

# Create an analysis dataset with the variables gender, age, attitude, deep, stra, surf and points 
# (by combining questions in the learning2014 data)

library(dplyr) # load the package for data wrangling

keep_columns <- c("gender","Age","Attitude","Points") # these are the data columns which need to be kept
lrn14_analysis <- select(learning2014, one_of(keep_columns))  # assin a new object and select kept columns
colnames(lrn14_analysis) <- c("gender", "age", "attitude", "points") # change of the kept column names

# define questions (observations from variables) acc. instructions
deep_q <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D06",  "D15", "D23", "D31")  # deep questions
surf_q <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32") # surface questions
stra_q <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28") # strategic questions

# Select the combined variables (columns) & scale the observations (mean) and add it to the analysis dataframe
deep <- select(learning2014, one_of(deep_q))
lrn14_analysis$deep <- round(rowMeans(deep, na.rm = TRUE), digits = 2) # values are rounded to 2 digits

surf <- select(learning2014, one_of(surf_q))
lrn14_analysis$surf <- round(rowMeans(surf,na.rm = TRUE), digits = 2)

stra <- select(learning2014, one_of(stra_q))
lrn14_analysis$stra <- round(rowMeans(stra, na.rm = TRUE), digits = 2)

# devide the number of the attitude column by 10 (its a sum of 10 questions)
lrn14_analysis$attitude <- lrn14_analysis$attitude / 10

# Exclude observations where the exam points variable is zero. 
lrn14_analysis <- filter(lrn14_analysis, points > 0)
```
  
The new dataframe was created. Now the structure is checked.  
```{r, structure, echo=TRUE, results='markup', message=FALSE, warning=FALSE}
# Check the analysis dataset
str(lrn14_analysis)
dim(lrn14_analysis)
```
  
The data consists now of 7 variables (columns) and 166 observations. The object name is "lrn14_analysis".  
Now follows the data analysis.  
  
***
### 1.3. Safe the updated dataframe as a .txt table or .csv table  

First the the working directory is set and then I save the dataframe with `write.table()` and the `write.csv()`functions.

```
# Set the working directory to IODS project folder ---- 
setwd("~/IODS-project") # set the wd to the IODS folder
```
```
# safe the analysis dataset to the "data" folder ----

write.table(lrn14_analysis, 
      file = "C:/Users/richla/OneDrive/1 C - R-Folder/11-IODS-course/IODS-project/data/lrn14_analysis_table.txt",
      sep = "\t", col.names = TRUE, row.names = TRUE)

write.csv(lrn14_analysis, 
      file = "C:/Users/richla/OneDrive/1 C - R-Folder/11-IODS-course/IODS-project/data/lrn14_analysis_table.csv",
      row.names = FALSE)
```
  
Afterwards I check if the tables can be read by R using the `read.table()` and `read.csv()` function plus the `%>%`operator piping to the `head()` function showing the first 6 observations of the dataframes.  

```{r, checktables,structure, echo=TRUE, results='markup', message=FALSE, warning=FALSE}
# check if the table can be read ----
read.table(file = 
             "C:/Users/richla/OneDrive/1 C - R-Folder/11-IODS-course/IODS-project/data/lrn14_analysis_table.txt") %>% head()

read.csv(file = 
           "C:/Users/richla/OneDrive/1 C - R-Folder/11-IODS-course/IODS-project/data/lrn14_analysis_table.csv")  %>%head()
```  
  

***   
## 2. Analysis

The work on the analysis script and documentation started on 6.11.2019.    

### 2.1. Reading the data    
Read the dataset table from my data folder and checked the dataframe structure and dimensions.  

``` 
# Set the working directory
setwd("~/IODS-project/data") # set work directory
```
```{r, dataread2, echo=TRUE, results='markdown', message=FALSE, warning=FALSE }
# Read the data file ----
lrn14_analysis <- 
read.table(file = "C:/Users/richla/OneDrive/1 C - R-Folder/11-IODS-course/IODS-project/data/lrn14_analysis_table.txt", stringsAsFactors = TRUE) 

lrn14_analysis %>% str() # read the data table and check the structure

```
  
When I read the data table I set the "stringsAsFactor" agument (in the read.table function) to `TRUE`. So the observations in the gender column "F" and "M" will become factors - here 1 & 2. The dataframe includes 166 observations (the rows) in 7 variables (the columns).  

### 2.2. Graphical overview and data summary     
The data we analyise consists of a survey from students relating their learning approaches.
The data includes the students' gender, age, exam points and the global attitude towards statistics (consisting of a sum of 10 questions related to students attitude towards statistics, each measured on the Likert scale (1-5). The attitude value was divided by 10 in the data wrangling part to show the value in the 1-5 scale. 

For a graphical overview of the dataset I used the `ggpairs()` function which results in several plots and correlations of the observations between the different variables.   

```{r, ovgraph, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
library(ggplot2) 
library(GGally) # to show the graph these packages need to be loaded

ov_lrn14_2 <- ggpairs(lrn14_analysis, mapping = aes(col = gender), title = "Graphical overview of lrn14_analysis", 
                      lower = list(combo = wrap("facethist", bins = 20))) 
                      # the color is chosen according to the different gender

ov_lrn14_2 # show the graph
```
```
# Save the overview plot

ggsave("OV_plot_lrn14.png", 
       plot = ov_lrn14_2, path = "~/IODS-project/data/", scale = 1, dpi = 300) 
# the graph is saved as .png file in my data folder
```  

Additionally a data summary table of the lrn14_analysis dataset was created.
  
```{r, sumtable, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
# Summary table of the lrn14_analysis data ----

Sum_table <- summary(lrn14_analysis)
Sum_table
```
  

***
### 2.3. Regression models  
#### 2.3.1. Simple regression model of **point ~ attitude**
  
I was testing different simple regression models with the exam points as dependent variable (y) using function `lm()`.
```
# Simple regressions ----

# regression with gender variable
gen_lm <- lm(points ~ gender, data = lrn14_analysis)
summary(gen_lm) # not significant

# regression with age variable
age_lm <- lm(points ~ age, data = lrn14_analysis)
summary(age_lm) # not significant
```  
``` {r, regression1, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
# attitude
att_lm <- lm(points ~ attitude, data = lrn14_analysis)
summary(att_lm)

par(mfrow = c(2,2))
plot(att_lm, which = c(1,2,5), main = "Diagnostic plots points ~ attitude")
```
  
#####  Regression model **point ~ attitude** interpretation  

Significant outcome was shown in the simple regression analysis of point ~ attitude  




***    

#### 2.3.2. Multiple regression model of **point ~ attitude + stra**

```{r, regression2, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
# points ~ attitude + stra ----

att_st_lm <- lm(points ~ attitude + stra, data = lrn14_analysis)
summary(att_st_lm)

par(mfrow = c(2,2))
plot(att_st_lm, which = c(1,2,5), main = "Diagnostic plots points ~ attitude + stra")
```









#####  Regression model **point ~ attitude + stra** interpretation  
***

#### 2.3.3. Multiple regression model of **point ~ attitude + deep + surf + stra**

```{r, regression3, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
# points ~ attitude + deep + surf + stra ----

att_de_su_st_lm <- lm(points ~ attitude + deep + surf + stra, data = lrn14_analysis)
summary(att_de_su_st_lm)

par(mfrow = c(2,2))
plot(att_de_su_st_lm, which = c(1,2,5))
```






#####  Regression model **point ~ attitude + deep + surf + stra** interpretation  
  








***
- Describe your work and results clearly. 
- Assume the reader has an introductory course level understanding of writing and reading R code as well as statistical methods.
- Assume the reader has no previous knowledge of your data or the more advanced methods you are using.
